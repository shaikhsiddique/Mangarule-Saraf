"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/cart/upsert";
exports.ids = ["pages/api/cart/upsert"];
exports.modules = {

/***/ "cookie":
/*!*************************!*\
  !*** external "cookie" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("cookie");

/***/ }),

/***/ "jsonwebtoken":
/*!*******************************!*\
  !*** external "jsonwebtoken" ***!
  \*******************************/
/***/ ((module) => {

module.exports = require("jsonwebtoken");

/***/ }),

/***/ "mongoose":
/*!***************************!*\
  !*** external "mongoose" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("mongoose");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcart%2Fupsert&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccart%5Cupsert.ts&middlewareConfigBase64=e30%3D!":
/*!********************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcart%2Fupsert&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccart%5Cupsert.ts&middlewareConfigBase64=e30%3D! ***!
  \********************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_cart_upsert_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\cart\\upsert.ts */ \"(api)/./pages/api/cart/upsert.ts\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_cart_upsert_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_cart_upsert_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/cart/upsert\",\n        pathname: \"/api/cart/upsert\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_cart_upsert_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmNhcnQlMkZ1cHNlcnQmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZwYWdlcyU1Q2FwaSU1Q2NhcnQlNUN1cHNlcnQudHMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ0w7QUFDMUQ7QUFDMEQ7QUFDMUQ7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLHNEQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQyxzREFBUTtBQUNwQztBQUNPLHdCQUF3QixnSEFBbUI7QUFDbEQ7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tYW5nYXJ1bGUtc2FyYWYvPzU3MTMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGFnZXNBUElSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL3BhZ2VzLWFwaS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzXFxcXGFwaVxcXFxjYXJ0XFxcXHVwc2VydC50c1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCBcImRlZmF1bHRcIik7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCBcImNvbmZpZ1wiKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuZXhwb3J0IGNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2NhcnQvdXBzZXJ0XCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvY2FydC91cHNlcnRcIixcbiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBhcmVuJ3QgdXNlZCBpbiBwcm9kdWN0aW9uLlxuICAgICAgICBidW5kbGVQYXRoOiBcIlwiLFxuICAgICAgICBmaWxlbmFtZTogXCJcIlxuICAgIH0sXG4gICAgdXNlcmxhbmRcbn0pO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYWdlcy1hcGkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcart%2Fupsert&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccart%5Cupsert.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./pages/api/cart/upsert.ts":
/*!**********************************!*\
  !*** ./pages/api/cart/upsert.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _server_db_connectMongo__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../server/db/connectMongo */ \"(api)/./server/db/connectMongo.ts\");\n/* harmony import */ var _server_models_User__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../server/models/User */ \"(api)/./server/models/User.ts\");\n/* harmony import */ var _server_utils_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../server/utils/auth */ \"(api)/./server/utils/auth.ts\");\n\n\n\nasync function handler(req, res) {\n    if (req.method !== \"POST\") return res.status(405).json({\n        message: \"Method not allowed\"\n    });\n    const authUser = (0,_server_utils_auth__WEBPACK_IMPORTED_MODULE_2__.getUserFromRequest)(req);\n    if (!authUser) return res.status(401).json({\n        message: \"Unauthorized\"\n    });\n    const { id, name, image, price, type, quantity } = req.body || {};\n    if (!id || !name || !image || !price || !type) return res.status(400).json({\n        message: \"Missing fields\"\n    });\n    const qty = Math.max(1, parseInt(String(quantity || 1), 10));\n    try {\n        await (0,_server_db_connectMongo__WEBPACK_IMPORTED_MODULE_0__.connectMongo)();\n        const user = await _server_models_User__WEBPACK_IMPORTED_MODULE_1__[\"default\"].findById(authUser.id);\n        if (!user) return res.status(404).json({\n            message: \"User not found\"\n        });\n        const idx = user.cart.findIndex((it)=>it.id === id);\n        if (idx >= 0) {\n            user.cart[idx].quantity = (user.cart[idx].quantity || 1) + qty;\n        } else {\n            user.cart.push({\n                id,\n                name,\n                image,\n                price,\n                type,\n                quantity: qty\n            });\n        }\n        await user.save();\n        return res.status(200).json({\n            cart: user.cart\n        });\n    } catch (e) {\n        return res.status(500).json({\n            message: \"Server error\",\n            error: e?.message || \"unknown\"\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvY2FydC91cHNlcnQudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUMrRDtBQUNoQjtBQUNpQjtBQUVqRCxlQUFlRyxRQUFRQyxHQUFtQixFQUFFQyxHQUFvQjtJQUM3RSxJQUFJRCxJQUFJRSxNQUFNLEtBQUssUUFBUSxPQUFPRCxJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1FBQUVDLFNBQVM7SUFBcUI7SUFDdkYsTUFBTUMsV0FBV1Isc0VBQWtCQSxDQUFDRTtJQUNwQyxJQUFJLENBQUNNLFVBQVUsT0FBT0wsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztRQUFFQyxTQUFTO0lBQWU7SUFFckUsTUFBTSxFQUFFRSxFQUFFLEVBQUVDLElBQUksRUFBRUMsS0FBSyxFQUFFQyxLQUFLLEVBQUVDLElBQUksRUFBRUMsUUFBUSxFQUFFLEdBQUdaLElBQUlhLElBQUksSUFBSSxDQUFDO0lBQ2hFLElBQUksQ0FBQ04sTUFBTSxDQUFDQyxRQUFRLENBQUNDLFNBQVMsQ0FBQ0MsU0FBUyxDQUFDQyxNQUFNLE9BQU9WLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7UUFBRUMsU0FBUztJQUFpQjtJQUN2RyxNQUFNUyxNQUFNQyxLQUFLQyxHQUFHLENBQUMsR0FBR0MsU0FBU0MsT0FBT04sWUFBWSxJQUFJO0lBRXhELElBQUk7UUFDRixNQUFNaEIscUVBQVlBO1FBQ2xCLE1BQU11QixPQUFPLE1BQU10QixvRUFBYSxDQUFDUyxTQUFTQyxFQUFFO1FBQzVDLElBQUksQ0FBQ1ksTUFBTSxPQUFPbEIsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFQyxTQUFTO1FBQWlCO1FBRW5FLE1BQU1nQixNQUFNRixLQUFLRyxJQUFJLENBQUNDLFNBQVMsQ0FBQyxDQUFDQyxLQUFZQSxHQUFHakIsRUFBRSxLQUFLQTtRQUN2RCxJQUFJYyxPQUFPLEdBQUc7WUFDWkYsS0FBS0csSUFBSSxDQUFDRCxJQUFJLENBQUNULFFBQVEsR0FBRyxDQUFDTyxLQUFLRyxJQUFJLENBQUNELElBQUksQ0FBQ1QsUUFBUSxJQUFJLEtBQUtFO1FBQzdELE9BQU87WUFDTEssS0FBS0csSUFBSSxDQUFDRyxJQUFJLENBQUM7Z0JBQUVsQjtnQkFBSUM7Z0JBQU1DO2dCQUFPQztnQkFBT0M7Z0JBQU1DLFVBQVVFO1lBQUk7UUFDL0Q7UUFDQSxNQUFNSyxLQUFLTyxJQUFJO1FBQ2YsT0FBT3pCLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRWtCLE1BQU1ILEtBQUtHLElBQUk7UUFBQztJQUNoRCxFQUFFLE9BQU9LLEdBQVE7UUFDZixPQUFPMUIsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFQyxTQUFTO1lBQWdCdUIsT0FBT0QsR0FBR3RCLFdBQVc7UUFBVTtJQUN4RjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbWFuZ2FydWxlLXNhcmFmLy4vcGFnZXMvYXBpL2NhcnQvdXBzZXJ0LnRzPzBhMjAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XHJcbmltcG9ydCB7IGNvbm5lY3RNb25nbyB9IGZyb20gJy4uLy4uLy4uL3NlcnZlci9kYi9jb25uZWN0TW9uZ28nO1xyXG5pbXBvcnQgVXNlciBmcm9tICcuLi8uLi8uLi9zZXJ2ZXIvbW9kZWxzL1VzZXInO1xyXG5pbXBvcnQgeyBnZXRVc2VyRnJvbVJlcXVlc3QgfSBmcm9tICcuLi8uLi8uLi9zZXJ2ZXIvdXRpbHMvYXV0aCc7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcTogTmV4dEFwaVJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlKSB7XHJcbiAgaWYgKHJlcS5tZXRob2QgIT09ICdQT1NUJykgcmV0dXJuIHJlcy5zdGF0dXMoNDA1KS5qc29uKHsgbWVzc2FnZTogJ01ldGhvZCBub3QgYWxsb3dlZCcgfSk7XHJcbiAgY29uc3QgYXV0aFVzZXIgPSBnZXRVc2VyRnJvbVJlcXVlc3QocmVxKTtcclxuICBpZiAoIWF1dGhVc2VyKSByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBtZXNzYWdlOiAnVW5hdXRob3JpemVkJyB9KTtcclxuXHJcbiAgY29uc3QgeyBpZCwgbmFtZSwgaW1hZ2UsIHByaWNlLCB0eXBlLCBxdWFudGl0eSB9ID0gcmVxLmJvZHkgfHwge307XHJcbiAgaWYgKCFpZCB8fCAhbmFtZSB8fCAhaW1hZ2UgfHwgIXByaWNlIHx8ICF0eXBlKSByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiAnTWlzc2luZyBmaWVsZHMnIH0pO1xyXG4gIGNvbnN0IHF0eSA9IE1hdGgubWF4KDEsIHBhcnNlSW50KFN0cmluZyhxdWFudGl0eSB8fCAxKSwgMTApKTtcclxuXHJcbiAgdHJ5IHtcclxuICAgIGF3YWl0IGNvbm5lY3RNb25nbygpO1xyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXIuZmluZEJ5SWQoYXV0aFVzZXIuaWQpO1xyXG4gICAgaWYgKCF1c2VyKSByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBtZXNzYWdlOiAnVXNlciBub3QgZm91bmQnIH0pO1xyXG5cclxuICAgIGNvbnN0IGlkeCA9IHVzZXIuY2FydC5maW5kSW5kZXgoKGl0OiBhbnkpID0+IGl0LmlkID09PSBpZCk7XHJcbiAgICBpZiAoaWR4ID49IDApIHtcclxuICAgICAgdXNlci5jYXJ0W2lkeF0ucXVhbnRpdHkgPSAodXNlci5jYXJ0W2lkeF0ucXVhbnRpdHkgfHwgMSkgKyBxdHk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB1c2VyLmNhcnQucHVzaCh7IGlkLCBuYW1lLCBpbWFnZSwgcHJpY2UsIHR5cGUsIHF1YW50aXR5OiBxdHkgfSk7XHJcbiAgICB9XHJcbiAgICBhd2FpdCB1c2VyLnNhdmUoKTtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IGNhcnQ6IHVzZXIuY2FydCB9KTtcclxuICB9IGNhdGNoIChlOiBhbnkpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3InLCBlcnJvcjogZT8ubWVzc2FnZSB8fCAndW5rbm93bicgfSk7XHJcbiAgfVxyXG59XHJcblxyXG5cclxuIl0sIm5hbWVzIjpbImNvbm5lY3RNb25nbyIsIlVzZXIiLCJnZXRVc2VyRnJvbVJlcXVlc3QiLCJoYW5kbGVyIiwicmVxIiwicmVzIiwibWV0aG9kIiwic3RhdHVzIiwianNvbiIsIm1lc3NhZ2UiLCJhdXRoVXNlciIsImlkIiwibmFtZSIsImltYWdlIiwicHJpY2UiLCJ0eXBlIiwicXVhbnRpdHkiLCJib2R5IiwicXR5IiwiTWF0aCIsIm1heCIsInBhcnNlSW50IiwiU3RyaW5nIiwidXNlciIsImZpbmRCeUlkIiwiaWR4IiwiY2FydCIsImZpbmRJbmRleCIsIml0IiwicHVzaCIsInNhdmUiLCJlIiwiZXJyb3IiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./pages/api/cart/upsert.ts\n");

/***/ }),

/***/ "(api)/./server/db/connectMongo.ts":
/*!***********************************!*\
  !*** ./server/db/connectMongo.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   connectMongo: () => (/* binding */ connectMongo)\n/* harmony export */ });\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongoose__WEBPACK_IMPORTED_MODULE_0__);\n\nlet isConnected = 0; // 0=disconnected, 1=connected\nasync function connectMongo() {\n    if (isConnected) return;\n    const uri = process.env.MONGO_URI;\n    if (!uri) throw new Error(\"MONGO_URI is not set\");\n    if ((mongoose__WEBPACK_IMPORTED_MODULE_0___default().connection).readyState === 1) {\n        isConnected = 1;\n        return;\n    }\n    await mongoose__WEBPACK_IMPORTED_MODULE_0___default().connect(uri, {\n        dbName: process.env.MONGO_DB || undefined\n    });\n    isConnected = 1;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zZXJ2ZXIvZGIvY29ubmVjdE1vbmdvLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFnQztBQUVoQyxJQUFJQyxjQUFjLEdBQUcsOEJBQThCO0FBRTVDLGVBQWVDO0lBQ3BCLElBQUlELGFBQWE7SUFDakIsTUFBTUUsTUFBTUMsUUFBUUMsR0FBRyxDQUFDQyxTQUFTO0lBQ2pDLElBQUksQ0FBQ0gsS0FBSyxNQUFNLElBQUlJLE1BQU07SUFDMUIsSUFBSVAsNERBQW1CLENBQUNTLFVBQVUsS0FBSyxHQUFHO1FBQ3hDUixjQUFjO1FBQ2Q7SUFDRjtJQUNBLE1BQU1ELHVEQUFnQixDQUFDRyxLQUFLO1FBQUVRLFFBQVFQLFFBQVFDLEdBQUcsQ0FBQ08sUUFBUSxJQUFJQztJQUFVO0lBQ3hFWixjQUFjO0FBQ2hCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbWFuZ2FydWxlLXNhcmFmLy4vc2VydmVyL2RiL2Nvbm5lY3RNb25nby50cz84OTEwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBtb25nb29zZSBmcm9tICdtb25nb29zZSc7XHJcblxyXG5sZXQgaXNDb25uZWN0ZWQgPSAwOyAvLyAwPWRpc2Nvbm5lY3RlZCwgMT1jb25uZWN0ZWRcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjb25uZWN0TW9uZ28oKSB7XHJcbiAgaWYgKGlzQ29ubmVjdGVkKSByZXR1cm47XHJcbiAgY29uc3QgdXJpID0gcHJvY2Vzcy5lbnYuTU9OR09fVVJJO1xyXG4gIGlmICghdXJpKSB0aHJvdyBuZXcgRXJyb3IoJ01PTkdPX1VSSSBpcyBub3Qgc2V0Jyk7XHJcbiAgaWYgKG1vbmdvb3NlLmNvbm5lY3Rpb24ucmVhZHlTdGF0ZSA9PT0gMSkge1xyXG4gICAgaXNDb25uZWN0ZWQgPSAxO1xyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuICBhd2FpdCBtb25nb29zZS5jb25uZWN0KHVyaSwgeyBkYk5hbWU6IHByb2Nlc3MuZW52Lk1PTkdPX0RCIHx8IHVuZGVmaW5lZCB9KTtcclxuICBpc0Nvbm5lY3RlZCA9IDE7XHJcbn1cclxuXHJcblxyXG4iXSwibmFtZXMiOlsibW9uZ29vc2UiLCJpc0Nvbm5lY3RlZCIsImNvbm5lY3RNb25nbyIsInVyaSIsInByb2Nlc3MiLCJlbnYiLCJNT05HT19VUkkiLCJFcnJvciIsImNvbm5lY3Rpb24iLCJyZWFkeVN0YXRlIiwiY29ubmVjdCIsImRiTmFtZSIsIk1PTkdPX0RCIiwidW5kZWZpbmVkIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./server/db/connectMongo.ts\n");

/***/ }),

/***/ "(api)/./server/models/User.ts":
/*!*******************************!*\
  !*** ./server/models/User.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongoose__WEBPACK_IMPORTED_MODULE_0__);\n\nconst CartItemSchema = new mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema({\n    id: {\n        type: String,\n        required: true\n    },\n    name: {\n        type: String,\n        required: true\n    },\n    image: {\n        type: String,\n        required: true\n    },\n    price: {\n        type: String,\n        required: true\n    },\n    type: {\n        type: String,\n        required: true\n    },\n    quantity: {\n        type: Number,\n        required: true,\n        default: 1\n    }\n}, {\n    _id: false\n});\nconst UserSchema = new mongoose__WEBPACK_IMPORTED_MODULE_0__.Schema({\n    name: {\n        type: String,\n        required: true\n    },\n    email: {\n        type: String,\n        required: true,\n        unique: true,\n        index: true\n    },\n    password: {\n        type: String,\n        required: true\n    },\n    phone: {\n        type: String,\n        required: true\n    },\n    cart: {\n        type: [\n            CartItemSchema\n        ],\n        default: []\n    }\n}, {\n    timestamps: true\n});\nconst User = mongoose__WEBPACK_IMPORTED_MODULE_0__.models.User || (0,mongoose__WEBPACK_IMPORTED_MODULE_0__.model)(\"User\", UserSchema);\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (User);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zZXJ2ZXIvbW9kZWxzL1VzZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQTJEO0FBRTNELE1BQU1HLGlCQUFpQixJQUFJSCw0Q0FBTUEsQ0FBQztJQUNoQ0ksSUFBSTtRQUFFQyxNQUFNQztRQUFRQyxVQUFVO0lBQUs7SUFDbkNDLE1BQU07UUFBRUgsTUFBTUM7UUFBUUMsVUFBVTtJQUFLO0lBQ3JDRSxPQUFPO1FBQUVKLE1BQU1DO1FBQVFDLFVBQVU7SUFBSztJQUN0Q0csT0FBTztRQUFFTCxNQUFNQztRQUFRQyxVQUFVO0lBQUs7SUFDdENGLE1BQU07UUFBRUEsTUFBTUM7UUFBUUMsVUFBVTtJQUFLO0lBQ3JDSSxVQUFVO1FBQUVOLE1BQU1PO1FBQVFMLFVBQVU7UUFBTU0sU0FBUztJQUFFO0FBQ3ZELEdBQUc7SUFBRUMsS0FBSztBQUFNO0FBRWhCLE1BQU1DLGFBQWEsSUFBSWYsNENBQU1BLENBQUM7SUFDNUJRLE1BQU07UUFBRUgsTUFBTUM7UUFBUUMsVUFBVTtJQUFLO0lBQ3JDUyxPQUFPO1FBQUVYLE1BQU1DO1FBQVFDLFVBQVU7UUFBTVUsUUFBUTtRQUFNQyxPQUFPO0lBQUs7SUFDakVDLFVBQVU7UUFBRWQsTUFBTUM7UUFBUUMsVUFBVTtJQUFLO0lBQ3pDYSxPQUFPO1FBQUVmLE1BQU1DO1FBQVFDLFVBQVU7SUFBSztJQUN0Q2MsTUFBTTtRQUFFaEIsTUFBTTtZQUFDRjtTQUFlO1FBQUVVLFNBQVMsRUFBRTtJQUFDO0FBQzlDLEdBQUc7SUFBRVMsWUFBWTtBQUFLO0FBRXRCLE1BQU1DLE9BQU90Qiw0Q0FBTUEsQ0FBQ3NCLElBQUksSUFBSXJCLCtDQUFLQSxDQUFDLFFBQVFhO0FBQzFDLGlFQUFlUSxJQUFJQSxFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbWFuZ2FydWxlLXNhcmFmLy4vc2VydmVyL21vZGVscy9Vc2VyLnRzPzkyZDYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG1vbmdvb3NlLCB7IFNjaGVtYSwgbW9kZWxzLCBtb2RlbCB9IGZyb20gJ21vbmdvb3NlJztcclxuXHJcbmNvbnN0IENhcnRJdGVtU2NoZW1hID0gbmV3IFNjaGVtYSh7XHJcbiAgaWQ6IHsgdHlwZTogU3RyaW5nLCByZXF1aXJlZDogdHJ1ZSB9LFxyXG4gIG5hbWU6IHsgdHlwZTogU3RyaW5nLCByZXF1aXJlZDogdHJ1ZSB9LFxyXG4gIGltYWdlOiB7IHR5cGU6IFN0cmluZywgcmVxdWlyZWQ6IHRydWUgfSxcclxuICBwcmljZTogeyB0eXBlOiBTdHJpbmcsIHJlcXVpcmVkOiB0cnVlIH0sXHJcbiAgdHlwZTogeyB0eXBlOiBTdHJpbmcsIHJlcXVpcmVkOiB0cnVlIH0sXHJcbiAgcXVhbnRpdHk6IHsgdHlwZTogTnVtYmVyLCByZXF1aXJlZDogdHJ1ZSwgZGVmYXVsdDogMSB9LFxyXG59LCB7IF9pZDogZmFsc2UgfSk7XHJcblxyXG5jb25zdCBVc2VyU2NoZW1hID0gbmV3IFNjaGVtYSh7XHJcbiAgbmFtZTogeyB0eXBlOiBTdHJpbmcsIHJlcXVpcmVkOiB0cnVlIH0sXHJcbiAgZW1haWw6IHsgdHlwZTogU3RyaW5nLCByZXF1aXJlZDogdHJ1ZSwgdW5pcXVlOiB0cnVlLCBpbmRleDogdHJ1ZSB9LFxyXG4gIHBhc3N3b3JkOiB7IHR5cGU6IFN0cmluZywgcmVxdWlyZWQ6IHRydWUgfSxcclxuICBwaG9uZTogeyB0eXBlOiBTdHJpbmcsIHJlcXVpcmVkOiB0cnVlIH0sXHJcbiAgY2FydDogeyB0eXBlOiBbQ2FydEl0ZW1TY2hlbWFdLCBkZWZhdWx0OiBbXSB9LFxyXG59LCB7IHRpbWVzdGFtcHM6IHRydWUgfSk7XHJcblxyXG5jb25zdCBVc2VyID0gbW9kZWxzLlVzZXIgfHwgbW9kZWwoJ1VzZXInLCBVc2VyU2NoZW1hKTtcclxuZXhwb3J0IGRlZmF1bHQgVXNlcjtcclxuXHJcblxyXG4iXSwibmFtZXMiOlsiU2NoZW1hIiwibW9kZWxzIiwibW9kZWwiLCJDYXJ0SXRlbVNjaGVtYSIsImlkIiwidHlwZSIsIlN0cmluZyIsInJlcXVpcmVkIiwibmFtZSIsImltYWdlIiwicHJpY2UiLCJxdWFudGl0eSIsIk51bWJlciIsImRlZmF1bHQiLCJfaWQiLCJVc2VyU2NoZW1hIiwiZW1haWwiLCJ1bmlxdWUiLCJpbmRleCIsInBhc3N3b3JkIiwicGhvbmUiLCJjYXJ0IiwidGltZXN0YW1wcyIsIlVzZXIiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./server/models/User.ts\n");

/***/ }),

/***/ "(api)/./server/utils/auth.ts":
/*!******************************!*\
  !*** ./server/utils/auth.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getUserFromRequest: () => (/* binding */ getUserFromRequest),\n/* harmony export */   setAuthCookie: () => (/* binding */ setAuthCookie),\n/* harmony export */   signToken: () => (/* binding */ signToken)\n/* harmony export */ });\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jsonwebtoken */ \"jsonwebtoken\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var cookie__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! cookie */ \"cookie\");\n/* harmony import */ var cookie__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(cookie__WEBPACK_IMPORTED_MODULE_1__);\n\n\nconst JWT_SECRET = process.env.JWT_SECRET || \"dev_secret_change_me\";\nconst COOKIE_NAME = \"ms_token\";\nfunction signToken(payload) {\n    return jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default().sign(payload, JWT_SECRET, {\n        expiresIn: \"7d\"\n    });\n}\nfunction setAuthCookie(res, token) {\n    const serialized = cookie__WEBPACK_IMPORTED_MODULE_1___default().serialize(COOKIE_NAME, token, {\n        httpOnly: true,\n        sameSite: \"lax\",\n        secure: \"development\" === \"production\",\n        path: \"/\",\n        maxAge: 7 * 24 * 60 * 60\n    });\n    res.setHeader(\"Set-Cookie\", serialized);\n}\nfunction getUserFromRequest(req) {\n    try {\n        const cookies = req.headers.cookie ? cookie__WEBPACK_IMPORTED_MODULE_1___default().parse(req.headers.cookie) : {};\n        const token = cookies[COOKIE_NAME];\n        if (!token) return null;\n        const decoded = jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default().verify(token, JWT_SECRET);\n        return {\n            id: decoded.id,\n            email: decoded.email\n        };\n    } catch  {\n        return null;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zZXJ2ZXIvdXRpbHMvYXV0aC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQStCO0FBRUg7QUFFNUIsTUFBTUUsYUFBYUMsUUFBUUMsR0FBRyxDQUFDRixVQUFVLElBQUk7QUFDN0MsTUFBTUcsY0FBYztBQUViLFNBQVNDLFVBQVVDLE9BQWU7SUFDdkMsT0FBT1Asd0RBQVEsQ0FBQ08sU0FBU0wsWUFBWTtRQUFFTyxXQUFXO0lBQUs7QUFDekQ7QUFFTyxTQUFTQyxjQUFjQyxHQUFvQixFQUFFQyxLQUFhO0lBQy9ELE1BQU1DLGFBQWFaLHVEQUFnQixDQUFDSSxhQUFhTyxPQUFPO1FBQ3RERyxVQUFVO1FBQ1ZDLFVBQVU7UUFDVkMsUUFBUWQsa0JBQXlCO1FBQ2pDZSxNQUFNO1FBQ05DLFFBQVEsSUFBSSxLQUFLLEtBQUs7SUFDeEI7SUFDQVIsSUFBSVMsU0FBUyxDQUFDLGNBQWNQO0FBQzlCO0FBRU8sU0FBU1EsbUJBQW1CQyxHQUFtQjtJQUNwRCxJQUFJO1FBQ0YsTUFBTUMsVUFBVUQsSUFBSUUsT0FBTyxDQUFDdkIsTUFBTSxHQUFHQSxtREFBWSxDQUFDcUIsSUFBSUUsT0FBTyxDQUFDdkIsTUFBTSxJQUFJLENBQUM7UUFDekUsTUFBTVcsUUFBUVcsT0FBTyxDQUFDbEIsWUFBWTtRQUNsQyxJQUFJLENBQUNPLE9BQU8sT0FBTztRQUNuQixNQUFNYyxVQUFVMUIsMERBQVUsQ0FBQ1ksT0FBT1Y7UUFDbEMsT0FBTztZQUFFMEIsSUFBSUYsUUFBUUUsRUFBRTtZQUFFQyxPQUFPSCxRQUFRRyxLQUFLO1FBQUM7SUFDaEQsRUFBRSxPQUFNO1FBQ04sT0FBTztJQUNUO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tYW5nYXJ1bGUtc2FyYWYvLi9zZXJ2ZXIvdXRpbHMvYXV0aC50cz8xMjk2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBqd3QgZnJvbSAnanNvbndlYnRva2VuJztcclxuaW1wb3J0IHR5cGUgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XHJcbmltcG9ydCBjb29raWUgZnJvbSAnY29va2llJztcclxuXHJcbmNvbnN0IEpXVF9TRUNSRVQgPSBwcm9jZXNzLmVudi5KV1RfU0VDUkVUIHx8ICdkZXZfc2VjcmV0X2NoYW5nZV9tZSc7XHJcbmNvbnN0IENPT0tJRV9OQU1FID0gJ21zX3Rva2VuJztcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzaWduVG9rZW4ocGF5bG9hZDogb2JqZWN0KSB7XHJcbiAgcmV0dXJuIGp3dC5zaWduKHBheWxvYWQsIEpXVF9TRUNSRVQsIHsgZXhwaXJlc0luOiAnN2QnIH0pO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc2V0QXV0aENvb2tpZShyZXM6IE5leHRBcGlSZXNwb25zZSwgdG9rZW46IHN0cmluZykge1xyXG4gIGNvbnN0IHNlcmlhbGl6ZWQgPSBjb29raWUuc2VyaWFsaXplKENPT0tJRV9OQU1FLCB0b2tlbiwge1xyXG4gICAgaHR0cE9ubHk6IHRydWUsXHJcbiAgICBzYW1lU2l0ZTogJ2xheCcsXHJcbiAgICBzZWN1cmU6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicsXHJcbiAgICBwYXRoOiAnLycsXHJcbiAgICBtYXhBZ2U6IDcgKiAyNCAqIDYwICogNjAsXHJcbiAgfSk7XHJcbiAgcmVzLnNldEhlYWRlcignU2V0LUNvb2tpZScsIHNlcmlhbGl6ZWQpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0VXNlckZyb21SZXF1ZXN0KHJlcTogTmV4dEFwaVJlcXVlc3QpOiB7IGlkOiBzdHJpbmc7IGVtYWlsOiBzdHJpbmcgfSB8IG51bGwge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBjb29raWVzID0gcmVxLmhlYWRlcnMuY29va2llID8gY29va2llLnBhcnNlKHJlcS5oZWFkZXJzLmNvb2tpZSkgOiB7fTtcclxuICAgIGNvbnN0IHRva2VuID0gY29va2llc1tDT09LSUVfTkFNRV07XHJcbiAgICBpZiAoIXRva2VuKSByZXR1cm4gbnVsbDtcclxuICAgIGNvbnN0IGRlY29kZWQgPSBqd3QudmVyaWZ5KHRva2VuLCBKV1RfU0VDUkVUKSBhcyBhbnk7XHJcbiAgICByZXR1cm4geyBpZDogZGVjb2RlZC5pZCwgZW1haWw6IGRlY29kZWQuZW1haWwgfTtcclxuICB9IGNhdGNoIHtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxufVxyXG5cclxuXHJcbiJdLCJuYW1lcyI6WyJqd3QiLCJjb29raWUiLCJKV1RfU0VDUkVUIiwicHJvY2VzcyIsImVudiIsIkNPT0tJRV9OQU1FIiwic2lnblRva2VuIiwicGF5bG9hZCIsInNpZ24iLCJleHBpcmVzSW4iLCJzZXRBdXRoQ29va2llIiwicmVzIiwidG9rZW4iLCJzZXJpYWxpemVkIiwic2VyaWFsaXplIiwiaHR0cE9ubHkiLCJzYW1lU2l0ZSIsInNlY3VyZSIsInBhdGgiLCJtYXhBZ2UiLCJzZXRIZWFkZXIiLCJnZXRVc2VyRnJvbVJlcXVlc3QiLCJyZXEiLCJjb29raWVzIiwiaGVhZGVycyIsInBhcnNlIiwiZGVjb2RlZCIsInZlcmlmeSIsImlkIiwiZW1haWwiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./server/utils/auth.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcart%2Fupsert&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccart%5Cupsert.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();